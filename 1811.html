<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shopping Cart New</title>
    <link rel="stylesheet" href="cartStyle.css" />
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="form.css" />
  </head>
  <body>
    <form id="body">
      <div class="header">
        <input type="text" class="search" id="vvv" placeholder="T√¨m ki·∫øm" />
        <button class="search-btn" onclick="search()">üîç</button>
      </div>

      <table class="cart-table" id="body">
        <thead>
          <tr>
            <th>
              <input
                type="checkbox"
                id="all"
                onclick="momCheckBox(this)"
              />
            </th>
            <th>T√™n S·∫£n ph·∫©m</th>
            <th>H√¨nh ·∫¢nh S·∫£n ph·∫©m</th>
            <th>ƒê∆°n gi√°</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>T·ªïng ti·ªÅn</th>
            <th>Thao t√°c</th>
          </tr>
        </thead>
        <tbody id="products-cart"></tbody>
      </table>

      <button type="button" class="buy" onclick="buy()">Mua</button>
      <div id="buy" class="delete-btn">0 VND</div>
      <!-- <button class="buy" onclick="showPaymentForm()">Show</button> -->
    </form>

    <div class="container" id="paymentForm">
      <div class="header">THANH TO√ÅN ƒê∆†N H√ÄNG</div>
      <table>
        <thead>
          <tr>
            <th>S·∫£n ph·∫©m</th>
            <th>S·ªë l∆∞·ª£ng</th>
            <th>Th√†nh ti·ªÅn</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
        <tfoot id="tfoot"></tfoot>
      </table>
      <div class="customer-info">
        <h4>Th√¥ng tin kh√°ch h√†ng</h4>
        <p><strong>H·ªç t√™n:</strong> Nguyen Van A</p>
        <p><strong>ƒê·ªãa ch·ªâ:</strong> 124 An D∆∞∆°ng V∆∞∆°ng</p>
        <p><strong>S·ªë ƒêT:</strong> 1234567890</p>
      </div>
      <div class="payment-method">
        <h4>Ph∆∞∆°ng th·ª©c thanh to√°n</h4>
        <form>
          <input
            type="radio"
            id="credit-card"
            name="payment"
            value="credit-card"
          />
          <label for="credit-card">Th·∫ª t√≠n d·ª•ng/Th·∫ª ghi n·ª£</label><br />
          <input
            type="radio"
            id="digital-wallet"
            name="payment"
            value="digital-wallet"
          />
          <label for="digital-wallet">V√≠ ƒëi·ªán t·ª≠ (Momo, PayPal...)</label><br />
          <input type="radio" id="cod" name="payment" value="cod" />
          <label for="cod">Thanh to√°n khi nh·∫≠n h√†ng (COD)</label>
        </form>
      </div>
      <div class="note">
        Vui l√≤ng ki·ªÉm tra kƒ© th√¥ng tin v√† s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n
      </div>
      <div class="payment-button">
        <button onclick="payment()">Thanh to√°n</button>
      </div>
    </div>

    <div class="form-container" id="end">
      <form>
        <div><h4>C·∫¢M ∆†N QU√ù KH√ÅCH</h4></div>
        <button onclick="quaylai()">Quay l·∫°i</button>
      </form>
    </div>

    <script>
        
      // Initialize or load productInCart from localStorage
      let productInCart = JSON.parse(localStorage.getItem("products")) || [];
     
    //   document.getElementById("all").checked = false;
      productInCart.forEach((item, index) => {
            item.check = "";
            
          });
          
      // let tmpdelete = productInCart;

      // Hi·ªÉn th·ªã s·∫£n ph·∫©m trong gi·ªè h√†ng v√† th√™m s·ª± ki·ªán checkbox
      function renderProductsToTable() {
        checkItem();
        

        const cartTable = document.getElementById("products-cart");
    cartTable.innerHTML = "";
    

        productInCart.forEach((item, index, checkbox) => {
          const totalPrice = (
            item.quantity * item.price.replace(/,/g, "")
          ).toLocaleString();
          // <input type="checkbox" id="myCheckbox" checked>
          //    document.getElementById("myCheckbox").checked = item.check;

          // if (checkboxes.checked)
          // {
          //     item.check='checked';
          // }
          // else{
          //     item.check='';
          // }

          // if (checkbox.checked) { // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
          //     item.check='checked';
          //      }
          //      else{
          //         item.check='';
          //      }
          //      saveToLocalStorage(); // Save to localStorage after deletion

          // if (checkbox.checked) { // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
          //     // const productbuy = productInCart[index];
          //     item.check = "checked";
          // }
          // else{
          //     item.check = "";
          // }

          // saveToLocalStorage(); // Save to localStorage after quantity change

          cartTable.innerHTML += `
        
            <tr>

                <td><input type="checkbox" id='myCheckbox' class="item-checkbox" onchange="sumMoney() " ${
                  item.check
                }></td>
                <th>${item.name}</th>
                <td>
                    <img src="${item.image}" width="80" alt=""> 
                </td>
                <td>${item.price.toLocaleString()} VND</td>
                <td>
                    <button class="delete-btn" onclick="changeQuantity(${index}, -1)">-</button>
                    <input class="delete-btn" type="text" style="text-align: center;" size="1" value="${
                      item.quantity
                    }" readonly>
                    <button class="delete-btn" onclick="changeQuantity(${index}, 1)">+</button>
                </td>
                <td>${totalPrice} VND</td>
                <td><button class="delete-btn" onclick="deleteProduct(${index})">X√≥a</button></td>
            </tr>
           
        `;
        });

        sumMoney(); // T√≠nh t·ªïng ti·ªÅn ban ƒë·∫ßu
        // saveToLocalStorage(); // Save to localStorage after quantity change
        // renderProductsToTable();
      }

      // Thay ƒë·ªïi s·ªë l∆∞·ª£ng s·∫£n ph·∫©m
      function changeQuantity(index, amount) {
        const product = productInCart[index];
        if (product.quantity + amount > 0) {
          product.quantity += amount;
          // checkboxes.forEach((checkbox, index) => {
          // if (checkboxes.checked) { // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
          //     const productbuy = productInCart[index];
          //     let totalPrice = productbuy.quantity * productbuy.price.replace(/,/g, '');
          // }
          // document.getElementById("index").checked = true;

          // });
          // saveToLocalStorage(); // Save to localStorage after quantity change
          // renderProductsToTable();
          // checkboxes.checked = true;
          // checkboxes.checked = true;
          // }
          // if(product.check=='')
          // product.check=='checked'
        } else {
          if (confirm("B·∫°n c√≥ mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh·ªèi gi·ªè h√†ng?")) {
            deleteProduct(index);
          }
        }
        saveToLocalStorage(); // Save to localStorage after quantity change
        renderProductsToTable();
      }

      // X√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng
      function deleteProduct(index) {
        productInCart.splice(index, 1);
        saveToLocalStorage(); // Save to localStorage after deletion
        renderProductsToTable();
      }

      // X√°c nh·∫≠n mua h√†ng
      function buy() {
        // const tmp = [];

        if (productInCart.length === 0) {
          alert("Gi·ªè h√†ng tr·ªëng, vui l√≤ng th√™m s·∫£n ph·∫©m tr∆∞·ªõc khi mua.");
        } else {
          showPaymentForm();

          // const checkboxes = document.querySelectorAll('.item-checkbox');

          // G√°n l·∫°i tmp v√†o productInCart
          //  productInCart = tmp;
          thanhtoan();

          // L∆∞u v√†o localStorage v√† c·∫≠p nh·∫≠t giao di·ªán
          // saveToLocalStorage();
          // renderProductsToTable();

          // alert('Mua h√†ng th√†nh c√¥ng!');
          //  payment();
        }
      }

      // Save productInCart to localStorage
      function saveToLocalStorage() {
        localStorage.setItem("products", JSON.stringify(productInCart));
      }

      // Kh·ªüi ƒë·ªông trang gi·ªè h√†ng
      function cartLoadPage() {
        renderProductsToTable();
      }

      // G·ªçi khi t·∫£i trang
      cartLoadPage();

      
      // Toggle ch·ªçn t·∫•t c·∫£ checkbox v√† t√≠nh t·ªïng ti·ªÅn

      function momCheckBox(masterCheckbox) {
        const checkboxes = document.querySelectorAll(".item-checkbox");
        checkboxes.forEach(
          (checkbox) => (checkbox.checked = masterCheckbox.checked)
        );
        if (masterCheckbox.checked) {
          productInCart.forEach((item, index) => {
            item.check = "checked";
          });
          // const product = productInCart[index];
        }
        if (!masterCheckbox.checked) {
          productInCart.forEach((item, index) => {
            item.check = "";
          });
        }
        saveToLocalStorage();
        renderProductsToTable();
        sumMoney(); // T√≠nh l·∫°i t·ªïng ti·ªÅn
      }
    //   function loadcheckbox(){
    //     for(let i = 0;i<=productInCart.length ;i++)
    //     productInCart[i].check = "";

    //   }
    //   loadcheckbox();
     
      
      

      function search() {
        //    const tmpdelete = productInCart;//= productInCart;

        var char = document.getElementById("vvv").value.toLowerCase();
        const www = document.getElementById("products-cart");
        www.innerHTML = "";
        productInCart.forEach((item, index) => {
          tmpdelete.push(productInCart[index]);
          const totalPrice = (
            item.quantity * item.price.replace(/,/g, "")
          ).toLocaleString();
          let str = item.name.toString().toLowerCase();
          if (str.includes(char)) {
            www.innerHTML += `
             <tr>
                <td><input type="checkbox" class="item-checkbox" onchange="sumMoney()"></td>
                <th>${item.name}</th>
                <td>
                    <img src="${item.image}" width="80" alt=""> 
                </td>
                <td>${item.price.toLocaleString()} VND</td>
                <td>
                    <button class="delete-btn" onclick="changeQuantity(${index}, -1)">-</button>
                    <input class="delete-btn" type="text" style="text-align: center;" size="1" value="${
                      item.quantity
                    }" readonly>
                    <button class="delete-btn" onclick="changeQuantity(${index}, 1)">+</button>
                </td>
                <td>${totalPrice} VND</td>
                <td><button class="delete-btn" onclick="deleteProduct(${index})">X√≥a</button></td>
            </tr>
        `;
          } else {
            productInCart.splice(index, 0);
            saveToLocalStorage(); // Save to localStorage after deletion
            renderProductsToTable();
          }
          // productInCart = [];
          // productInCart = tmpdelete;
        });
        // if(char === ""){
        //          productInCart = tmpdelete;
        //         saveToLocalStorage(); // Save to localStorage after deletion
        //         renderProductsToTable();
        //     }
      }

      const paymentForm = document.getElementById("paymentForm");
      paymentForm.style.display = "none"; // ·∫®n b·∫£ng

      const end = document.getElementById("end");
      end.style.display = "none"; // ·∫®n b·∫£ng

      function showPaymentForm() {
        const checkboxes = document.querySelectorAll(".item-checkbox");
        let dem = 0;
        checkboxes.forEach((checkbox) => {
          if (checkbox.checked)
            // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
            dem += 1;
        });
        if (dem == 0) {
          alert("B·∫°n v·∫´n ch∆∞a ch·ªçn s·∫£n ph·∫©m n√†o ƒë·ªÉ mua.");
        } else {
          const paymentForm = document.getElementById("paymentForm");
          const body = document.getElementById("body");
          body.style.display = "none"; // ·∫®n b·∫£ng
          if (
            paymentForm.style.display === "none" ||
            paymentForm.style.display === ""
          ) {
            paymentForm.style.display = "block"; // Hi·ªÉn th·ªã b·∫£ng
          }
        }
        // else {
        //     paymentForm.style.display = "none"; // ·∫®n b·∫£ng
        // }
      }
      function thanhtoan() {
        const tbody = document.getElementById("tbody");
        const tfoot = document.getElementById("tfoot");
        tbody.innerHTML = "";
        tfoot.innerHTML = "";
        const checkboxes = document.querySelectorAll(".item-checkbox");
        let totalbuy = 0;

        checkboxes.forEach((checkbox, index) => {
          if (checkbox.checked) {
            // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
            const productbuy = productInCart[index];
            let totalPrice =
              productbuy.quantity * productbuy.price.replace(/,/g, "");
            totalbuy +=
              productbuy.quantity * productbuy.price.replace(/,/g, "");
            tbody.innerHTML += `
                 <tr>
                    <td>${productbuy.name}</td>
                    <td>${productbuy.quantity}</td>
                    <td>${totalPrice.toLocaleString()} VND</td>
                </tr>
        `;
          }
        });
        tfoot.innerHTML += `
                 <tr>
                    <td colspan="2" class="total">T·ªïng</td>
                    <td class="total">${totalbuy.toLocaleString()} VND</td>
                </tr>
        `;

        //         productInCart.forEach((item, index) => {
        //     const totalPrice = (item.quantity * item.price.replace(/,/g, '')).toLocaleString();
        //     tbody.innerHTML += `
        //              <tr>
        //                 <td>${item.name}</td>
        //                 <td>${item.quantity}</td>
        //                 <td>2${totalPrice} VND</td>
        //             </tr>
        //     `;
        //     tfoot.innerHTML += `
        //              <tr>
        //                 <td colspan="2" class="total">T·ªïng</td>
        //                 <td class="total">${totalPrice} VND</td>
        //             </tr>
        //     `;

        // });
      }
      // T√≠nh t·ªïng ti·ªÅn c·ªßa c√°c s·∫£n ph·∫©m ƒë∆∞·ª£c ƒë√°nh d·∫•u
      function sumMoney() {
        const checkboxes = document.querySelectorAll(".item-checkbox");
        let total = 0;

        checkboxes.forEach((checkbox, index) => {
          if (checkbox.checked) {
            // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
            const product = productInCart[index];
            total += product.quantity * product.price.replace(/,/g, "");
          }
        });

        document.getElementById("buy").innerHTML =
          total.toLocaleString() + " VND"; // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
      }
      function payment() {
        alert("B·∫°n v·∫´n ch∆∞a ch·ªçn s·∫£n ph·∫©m n√†o ƒë·ªÉ mua.");
        const end = document.getElementById("end");
        paymentForm.style.display = "none"; // ·∫®n b·∫£ng
        if (end.style.display === "none" || end.style.display === "") {
          end.style.display = "block"; // Hi·ªÉn th·ªã b·∫£ng
        }
        //     checkboxes.forEach((checkbox, index) => {
        // if (checkbox.checked) { // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
        //     productInCart.splice(index, 1);
        //      saveToLocalStorage(); // Save to localStorage after deletion
        //      renderProductsToTable();
      }
      function quaylai() {
        alert("M√¨nh quay l·∫°i nha");
        const tmp = [];
        const checkboxes = document.querySelectorAll(".item-checkbox");
        // L·∫•y s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn
        checkboxes.forEach((checkbox, index) => {
          if (!checkbox.checked) {
            tmp.push(productInCart[index]);
            // alert('delete ' + index);
            // productInCart.splice(index, 1);

            // tmp.push(productInCart[index]);
            // saveToLocalStorage(); // Save to localStorage after deletion
            // renderProductsToTable();
          }
        });

        productInCart = [];
        // G√°n l·∫°i tmp v√†o productInCart
        productInCart = tmp;
        saveToLocalStorage(); // Save to localStorage after deletion
        renderProductsToTable();
        const end = document.getElementById("end");
        const body = document.getElementById("body");
        end.style.display = "none"; // ·∫®n b·∫£ng
        if (body.style.display === "none" || body.style.display === "") {
          body.style.display = "block"; // Hi·ªÉn th·ªã b·∫£ng
        }
      }
    
     function checkItem(){
        const checkboxes = document.querySelectorAll(".item-checkbox");
       
        all=1;
        checkboxes.forEach((checkbox, index) => {
           
      
          if (checkbox.checked) {
            // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
            const productbuy = productInCart[index];
            productbuy.check = "checked";
            // document.getElementById("select-all").checked = true;
            
            
          }
          if (!checkbox.checked) {
            const productbuy = productInCart[index];
            productbuy.check = "";
            // all = 1;
           
          }
      
         // let all = 0;
            // if(all==0){
            //     document.getElementById("all").checked = true;

            // }
        //   if(dem == 0){
        //     alert("dem " + dem);


        //   }
        
        });
        // all = 0;
        // if(all==0){
        //         document.getElementById("all").checked = true;

        //     }
        // document.getElementById("all").checked = true;
        
      }
    //   while(all!=0){
    //     const checkboxes = document.querySelectorAll(".item-checkbox");
       
    //     let all=0;
    //     checkboxes.forEach((checkbox, index) => {
           
      
    //       if (checkbox.checked) {
    //         // N·∫øu checkbox ƒë∆∞·ª£c t√≠ch
    //         const productbuy = productInCart[index];
    //         productbuy.check = "checked";
    //         // document.getElementById("select-all").checked = true;
            
            
    //       }
    //       if (!checkbox.checked) {
    //         const productbuy = productInCart[index];
    //         productbuy.check = "";
    //         all = 1;
            
           
    //       }
 
        
    //     });
    
    //     if(all==0){
    //             document.getElementById("all").checked = true;

    //         }
    //     }
      
    
    </script>
  </body>
</html>
